
SELECT 
CONCAT(CASE WHEN SUA501.UA_NUM <> '' THEN SUA501.UA_FILIAL WHEN SUA.UA_NUM <> '' THEN SUA.UA_FILIAL ELSE '' END, ' - ', CASE WHEN SUA501.UA_NUM <> '' THEN SUA501.UA_NUM WHEN SUA.UA_NUM <> '' THEN SUA.UA_NUM ELSE '' END) AS CHAVE,
SF2.F2_FILIAL, 
SF2.F2_SERIE	AS SERIE, 
SF2.F2_DOC		AS DOC,
CASE WHEN SUA501.UA_NUM <> '' THEN SUA501.UA_FILIAL WHEN SUA.UA_NUM <> '' THEN SUA.UA_FILIAL ELSE '' END AS FILIAL,
CASE WHEN SUA501.UA_NUM <> '' THEN SUA501.UA_NUM WHEN SUA.UA_NUM <> '' THEN SUA.UA_NUM ELSE '' END AS ATENDIMENTO,
SUM((SB5.B5_LARG * SB5.B5_COMPR) * SD2.D2_QUANT) AS TOTAL_M2,
SUM((SB5.B5_LARG * SB5.B5_COMPR * SB5.B5_ALTURA) * SD2.D2_QUANT) AS TOTAL_M3
FROM SF2010 SF2 
LEFT JOIN SC9010 SC9 ON SC9.D_E_L_E_T_ = '' AND SC9.C9_FILIAL = SF2.F2_FILIAL AND SC9.C9_SERIENF = SF2.F2_SERIE AND SC9.C9_NFISCAL = SF2.F2_DOC
LEFT JOIN SL1010 SL1 ON SL1.D_E_L_E_T_ = '' AND SL1.L1_FILIAL = SC9.C9_FILIAL AND SL1.L1_PEDRES = SC9.C9_PEDIDO
LEFT JOIN SUA010 SUA ON SUA.D_E_L_E_T_ = '' AND SUA.UA_FILIAL = SL1.L1_FILIAL AND SUA.UA_NUM = SL1.L1_NUMATEN
LEFT JOIN SL1010 SL1501 ON SL1501.D_E_L_E_T_ = '' AND SL1501.L1_FILIAL = SF2.F2_FILIAL AND SL1501.L1_SERIE = SF2.F2_SERIE AND SL1501.L1_DOC = SF2.F2_DOC
LEFT JOIN SUA010 SUA501 ON SUA501.D_E_L_E_T_ = '' AND SUA501.UA_FILIAL = SL1501.L1_FILIAL AND SUA501.UA_NUM = SL1501.L1_NUMATEN
LEFT JOIN SA4010 SA4501 ON SA4501.D_E_L_E_T_ = '' AND SA4501.A4_COD = SUA501.UA_ZCODFRT
LEFT JOIN SD2010 SD2 ON SD2.D_E_L_E_T_ = '' AND SD2.D2_FILIAL = SF2.F2_FILIAL AND SD2.D2_SERIE = SF2.F2_SERIE AND SD2.D2_DOC = SF2.F2_DOC
LEFT JOIN SB5010 SB5 ON SB5.D_E_L_E_T_ = '' AND SB5.B5_COD = SD2.D2_COD
WHERE 1=1
AND SF2.D_E_L_E_T_ = '' 
AND CONCAT(SUA501.UA_NUM, SUA.UA_NUM) <> ''
GROUP BY 
SF2.F2_FILIAL,
SF2.F2_SERIE,
SF2.F2_DOC,
SF2.F2_CLIENTE,
SUA.UA_FILIAL,
SUA501.UA_FILIAL,
SUA.UA_NUM,
SUA501.UA_NUM