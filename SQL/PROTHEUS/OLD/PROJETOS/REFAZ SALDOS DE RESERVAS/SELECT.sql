


DEFINE 	@PROD VARCHAR(15)
DECLARE @PROD VARCHAR(15)
SET @PROD = $(@PROD)



SELECT 'FILIAL 01' AS FILIAL

SELECT
SB2.B2_FILIAL	AS FILIAL,
SB2.B2_COD		AS CODPROD,
SB1.B1_ZDESRDZ	AS PRODUTO,
SB2.B2_LOCAL	AS ARMAZEM,
SB2.B2_QATU		AS SLD_FIS,  
SB2.B2_RESERVA	AS SLD_RES,
(SB2.B2_QATU - SB2.B2_RESERVA) AS SLD_DISP,
ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0101' 
AND C9_PRODUTO = SB2.B2_COD
),0)			AS QTD_C9,
ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0101' 
AND C0_PRODUTO = SB2.B2_COD
),0)			AS QTD_C0,
ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0101' 
AND C9_PRODUTO = SB2.B2_COD
),0) + ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0101' 
AND C0_PRODUTO = SB2.B2_COD
),0)			AS TOTAL_RES,
SB2.B2_RESERVA,
CASE 
	WHEN
		SB2.B2_RESERVA = ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0101' 
AND C9_PRODUTO = SB2.B2_COD
),0) + ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0101' 
AND C0_PRODUTO = SB2.B2_COD
),0)
THEN 'S'
ELSE 'N'
END AS CORRETO
FROM SB2010 SB2
LEFT JOIN SB1010 SB1 ON SB1.D_E_L_E_T_  = '' AND SB1.B1_COD = SB2.B2_COD 
WHERE 1=1
AND SB2.D_E_L_E_T_ = ''
AND SB2.B2_FILIAL = '0101'
AND SB2.B2_LOCAL = '01'
AND SUBSTRING(SB1.B1_GRUPO,1,2) = 'MR'
AND SB2.B2_COD = @PROD


SELECT 'FILIAL 02' AS FILIAL

SELECT
SB2.B2_FILIAL	AS FILIAL,
SB2.B2_COD		AS CODPROD,
SB1.B1_ZDESRDZ	AS PRODUTO,
SB2.B2_LOCAL	AS ARMAZEM,
SB2.B2_QATU		AS SLD_FIS,  
SB2.B2_RESERVA	AS SLD_RES,
(SB2.B2_QATU - SB2.B2_RESERVA) AS SLD_DISP,
ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0102' 
AND C9_PRODUTO = SB2.B2_COD
),0)			AS QTD_C9,
ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0102' 
AND C0_PRODUTO = SB2.B2_COD
),0)			AS QTD_C0,
ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0102' 
AND C9_PRODUTO = SB2.B2_COD
),0) + ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0102' 
AND C0_PRODUTO = SB2.B2_COD
),0)			AS TOTAL_RES,
SB2.B2_RESERVA,
CASE 
	WHEN
		SB2.B2_RESERVA = ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0102' 
AND C9_PRODUTO = SB2.B2_COD
),0) + ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0102' 
AND C0_PRODUTO = SB2.B2_COD
),0)
THEN 'S'
ELSE 'N'
END AS CORRETO
FROM SB2010 SB2
LEFT JOIN SB1010 SB1 ON SB1.D_E_L_E_T_  = '' AND SB1.B1_COD = SB2.B2_COD 
WHERE 1=1
AND SB2.D_E_L_E_T_ = ''
AND SB2.B2_FILIAL = '0102'
AND SB2.B2_LOCAL = '01'
AND SUBSTRING(SB1.B1_GRUPO,1,2) = 'MR'
AND SB2.B2_COD = @PROD


SELECT 'FILIAL 03' AS FILIAL

SELECT
SB2.B2_FILIAL	AS FILIAL,
SB2.B2_COD		AS CODPROD,
SB1.B1_ZDESRDZ	AS PRODUTO,
SB2.B2_LOCAL	AS ARMAZEM,
SB2.B2_QATU		AS SLD_FIS,  
SB2.B2_RESERVA	AS SLD_RES,
(SB2.B2_QATU - SB2.B2_RESERVA) AS SLD_DISP,
ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0103' 
AND C9_PRODUTO = SB2.B2_COD
),0)			AS QTD_C9,
ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0103' 
AND C0_PRODUTO = SB2.B2_COD
),0)			AS QTD_C0,
ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0103' 
AND C9_PRODUTO = SB2.B2_COD
),0) + ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0103' 
AND C0_PRODUTO = SB2.B2_COD
),0)			AS TOTAL_RES,
SB2.B2_RESERVA,
CASE 
	WHEN
		SB2.B2_RESERVA = ISNULL((
SELECT 
SUM(C9_QTDLIB) 
FROM SC9010 
WHERE 1=1
AND D_E_L_E_T_ = '' 
AND C9_NFISCAL = '' 
AND C9_BLEST = '' 
AND C9_FILIAL = '0103' 
AND C9_PRODUTO = SB2.B2_COD
),0) + ISNULL((
SELECT 
SUM(C0_QTDPED) + SUM(C0_QUANT)
FROM SC0010 
WHERE 1=1
AND D_E_L_E_T_ = ''
AND C0_FILRES = '0103' 
AND C0_PRODUTO = SB2.B2_COD
),0)
THEN 'S'
ELSE 'N'
END AS CORRETO
FROM SB2010 SB2
LEFT JOIN SB1010 SB1 ON SB1.D_E_L_E_T_  = '' AND SB1.B1_COD = SB2.B2_COD 
WHERE 1=1
AND SB2.D_E_L_E_T_ = ''
AND SB2.B2_FILIAL = '0103'
AND SB2.B2_LOCAL = '01'
AND SUBSTRING(SB1.B1_GRUPO,1,2) = 'MR'
AND SB2.B2_COD = @PROD