/*

UPDATE SE3 - COMISSÃO

PROCEDURE: SE3 - ACERTO COMISSÃO

Por: EDUARDO JORGE

Em: 27/08/2020

*/


CREATE PROCEDURE SE3_ACERTO_COMISSAO AS

UPDATE SE3010 SET E3_BASE = E1_BASCOM1, E3_COMIS = (E1_BASCOM1*(A.E1_COMIS1/100))
FROM SE1010 AS A
LEFT JOIN SE3010 AS B ON B.D_E_L_E_T_ = '' AND B.E3_FILIAL = A.E1_FILIAL AND B.E3_SERIE = A.E1_PREFIXO AND B.E3_NUM = A.E1_NUM AND B.E3_PARCELA = A.E1_PARCELA AND B.E3_TIPO = A.E1_TIPO AND B.E3_CODCLI = A.E1_CLIENTE AND B.E3_LOJA = A.E1_LOJA 
WHERE A.D_E_L_E_T_ = '' 
AND A.E1_EMISSAO BETWEEN CONCAT(SUBSTRING(CONVERT(VARCHAR, CAST(GETDATE() AS DATETIME),112),1,6),'01') AND CONCAT(SUBSTRING(CONVERT(VARCHAR, CAST(GETDATE() AS DATETIME),112),1,6),'31')
AND A.E1_BASCOM1 <>  B.E3_BASE
AND B.E3_ORIGEM  <> 'B'
--AND A.E1_VEND1 = '000070'
--AND A.E1_FILIAL = '0101' 
--AND A.E1_PREFIXO = '700' 
--AND A.E1_NUM = '000002147' 

GO