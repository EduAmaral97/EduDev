

SELECT 
	'' AS TIPO_REGISTRO,
	'SICREDI'	AS ADQUIRENTE,
	SE1.E1_FILIAL AS LOJA_FILIAL,
	CASE 
		WHEN SE1.E1_CLIENTE = '050'
	THEN SUBSTRING(SE1.E1_NOMCLI,5,5)
		WHEN SE1.E1_CLIENTE = '051'
	THEN SUBSTRING(SE1.E1_NOMCLI,5,5)
		WHEN SE1.E1_CLIENTE = '052'
	THEN SUBSTRING(SE1.E1_NOMCLI,5,7)
		WHEN SE1.E1_CLIENTE = '053'
	THEN SUBSTRING(SE1.E1_NOMCLI,5,7)
		WHEN SE1.E1_CLIENTE = '054'
	THEN SUBSTRING(SE1.E1_NOMCLI,5,4)
		WHEN SE1.E1_CLIENTE = '055'
	THEN SUBSTRING(SE1.E1_NOMCLI,5,4)
		WHEN SE1.E1_CLIENTE = '058'
	THEN SUBSTRING(SE1.E1_NOMCLI,5,5)
	ELSE ''
	END AS BANDEIRA,
	SE1.E1_TIPO AS TIPO_TRANSACAO,
	CASE
		WHEN SE1.E1_PARCELA = '11'
	THEN '01'
		WHEN SE1.E1_PARCELA = '12'
	THEN '02'
		WHEN SE1.E1_PARCELA = '13'
	THEN '03'
		WHEN SE1.E1_PARCELA = '14'
	THEN '04'
		WHEN SE1.E1_PARCELA = '15'
	THEN '05'
		WHEN SE1.E1_PARCELA = '16'
	THEN '06'
		WHEN SE1.E1_PARCELA = '17'
	THEN '07'
		WHEN SE1.E1_PARCELA = '18'
	THEN '08'
		WHEN SE1.E1_PARCELA = '19'
	THEN '09'
		WHEN SE1.E1_PARCELA = '20'
	THEN '10'
	ELSE SE1.E1_PARCELA
	END AS NRO_PARCELA,
	ISNULL((SELECT COUNT(E1_PARCELA) FROM SE1010 WHERE D_E_L_E_T_ = '' AND E1_FILIAL = SE1.E1_FILIAL AND E1_NUM = SE1.E1_NUM AND  E1_TIPO = SE1.E1_TIPO AND E1_CLIENTE = SE1.E1_CLIENTE AND E1_NUMCART = SE1.E1_NUMCART),0) AS QTD_PARCELAS,
	'' AS TID,
	E1_NUMCART AS NSU,
	'' AS AUTORIZACAO,
	E1_VLRREAL AS VALOR,
	CASE
		WHEN SL1A.L1_CLIENTE <> ''
	THEN CONCAT(SL1A.L1_CLIENTE, ' - ', SA1A.A1_NOME)
		WHEN SL1B.L1_CLIENTE <> ''
	THEN CONCAT(SL1B.L1_CLIENTE, ' - ', SA1B.A1_NOME)
	ELSE ''
	END AS CLIENTE,
	CONVERT(VARCHAR,CAST(SE1.E1_EMISSAO AS DATETIME),103) AS DATA_VENDA,
	'POS' AS ORIGEM,
	'' AS SEQUENCIA,
	CASE
		WHEN SL1B.L1_DOC <> '' 
	THEN SL1B.L1_DOC
		WHEN SC5.C5_NOTA <> ''
	THEN SC5.C5_NOTA
	ELSE ''
	END NOTA_FISCAL,
	CASE
		WHEN SL1A.L1_CLIENTE <> ''
	THEN SA1A.A1_CGC
		WHEN SL1B.L1_CLIENTE <> ''
	THEN SA1B.A1_CGC
	ELSE ''
	END AS CPF_CNPJ,
	'' AS ESTABELECIMENTO,
	CONVERT(VARCHAR,CAST(SE1.E1_VENCREA AS DATETIME),103)  AS DATA_VENCIMENTO,
	'' AS NUMERO_CARTAO,
	'' AS REFERENCIA1
FROM SE1010 SE1
	LEFT JOIN SL1010 SL1A ON SL1A.D_E_L_E_T_ = '' AND SL1A.L1_FILIAL = SE1.E1_FILIAL AND SL1A.L1_SERPED = SE1.E1_PREFIXO AND SL1A.L1_DOCPED = SE1.E1_NUM AND SE1.E1_PREFIXO = '700' 
	LEFT JOIN SL1010 SL1B ON SL1B.D_E_L_E_T_ = '' AND SL1B.L1_FILIAL = SE1.E1_FILIAL AND SL1B.L1_SERIE = SE1.E1_PREFIXO AND SL1B.L1_DOC = SE1.E1_NUM AND SE1.E1_PREFIXO <> '700' 
	LEFT JOIN SA1010 SA1A ON SA1A.D_E_L_E_T_ = '' AND SA1A.A1_COD = SL1A.L1_CLIENTE AND SA1A.A1_LOJA = SL1A.L1_LOJA
	LEFT JOIN SA1010 SA1B ON SA1B.D_E_L_E_T_ = '' AND SA1B.A1_COD = SL1B.L1_CLIENTE AND SA1B.A1_LOJA = SL1B.L1_LOJA
	LEFT JOIN SL1010 SL1A2 ON SL1A2.D_E_L_E_T_ = '' AND SL1A2.L1_FILIAL = SL1A.L1_FILRES AND SL1A2.L1_NUM = SL1A.L1_ORCRES 
	LEFT JOIN SC5010 SC5 ON SC5.D_E_L_E_T_ = '' AND SC5.C5_FILIAL = SL1A2.L1_FILIAL AND SC5.C5_NUM = SL1A2.L1_PEDRES
WHERE 1=1
	AND SE1.D_E_L_E_T_ = ''
	AND YEAR(SE1.E1_EMISSAO) = 2021
	AND SE1.E1_TIPO IN ('CC','CD')
	AND SE1.E1_CLIENTE <> '059'
	--AND SE1.E1_NUMCART = '009547'
	--AND SE1.E1_NUM IN ('000002147','000002150')

