
SELECT 
	SE3.E3_FILIAL	AS FILIAL,
	SE3.E3_SERIE	AS SERIE,
	SE3.E3_NUM		AS TITULO,
	SE3.E3_PEDIDO	AS ATENDIMENTO,
	CONVERT(VARCHAR,CAST(SE3.E3_EMISSAO AS DATETIME),103) AS EMISSAO_FRETE,
	CASE
		WHEN SL2A.L2_DOC <> ''
	THEN SD2501.D2_SERIE
	ELSE SD2700.D2_SERIE
	END AS SERIE_NF,
	CASE
		WHEN SL2A.L2_DOC <> ''
	THEN SD2501.D2_DOC
	ELSE SD2700.D2_DOC
	END AS NUM_NF,
	CASE
		WHEN SL2A.L2_DOC <> ''
	THEN CONVERT(VARCHAR,CAST( SD2501.D2_EMISSAO AS DATETIME),103)
	ELSE CONVERT(VARCHAR,CAST( SD2700.D2_EMISSAO AS DATETIME),103)
	END AS EMISSAO_NF,
	SE3.E3_CODCLI	AS COD_CLI,
	SA1.A1_NOME		AS CLIENTE,
	SA1.A1_MUN		AS CIDADE,
	SE3.E3_VEND		AS COD_VEND,
	SA3.A3_NOME		AS VENDEDOR,
	CASE
		WHEN SL2A.L2_DOC <> ''
	THEN SUBSTRING(SD2501.D2_EMISSAO,5,2)
	ELSE SUBSTRING(SD2700.D2_EMISSAO,5,2)
	END AS MES_NF,
	CASE
		WHEN SL2A.L2_DOC <> ''
	THEN SUBSTRING(SD2501.D2_EMISSAO,1,4)
	ELSE SUBSTRING(SD2700.D2_EMISSAO,1,4)
	END AS ANO_NF,
	SE3.E3_BASE		AS	VALOR_FRETE
FROM SE3010 SE3 
	LEFT JOIN SUA010 SUA ON SUA.D_E_L_E_T_ = '' AND SUA.UA_FILIAL = SE3.E3_FILIAL AND SUA.UA_NUM = SE3.E3_PEDIDO
	LEFT JOIN SA1010 SA1 ON SA1.D_E_L_E_T_ = '' AND SA1.A1_COD = SE3.E3_CODCLI AND SA1.A1_LOJA = SE3.E3_LOJA
	LEFT JOIN SA3010 SA3 ON SA3.D_E_L_E_T_ = '' AND SA3.A3_COD = SE3.E3_VEND
	LEFT JOIN SL1010 SL1 ON SL1.D_E_L_E_T_ = '' AND SL1.L1_FILIAL = SUA.UA_FILIAL AND SL1.L1_NUMATEN = SUA.UA_NUM AND SL1.L1_ORCRES = ''
	LEFT JOIN SL2010 SL2A ON SL2A.D_E_L_E_T_ = '' AND SL2A.L2_FILIAL = SL1.L1_FILIAL AND SL2A.L2_NUM = SL1.L1_NUM
	LEFT JOIN SL2010 SL2B ON SL2B.D_E_L_E_T_ = '' AND SL2B.L2_FILIAL = SL2A.L2_FILRES AND SL2B.L2_NUM = SL2A.L2_ORCRES AND SL2B.L2_PRODUTO = SL2A.L2_PRODUTO
	LEFT JOIN SC6010 SC6 ON SC6.D_E_L_E_T_ = '' AND SC6.C6_FILIAL = SL2B.L2_FILIAL AND SC6.C6_NUM = SL2B.L2_PEDRES AND SC6.C6_PRODUTO = SL2B.L2_PRODUTO AND SC6.C6_ITEM = SL2B.L2_ITEM 
	LEFT JOIN SC9010 SC9 ON SC9.D_E_L_E_T_ = '' AND SC9.C9_FILIAL = SC6.C6_FILIAL AND SC9.C9_PEDIDO = SC6.C6_NUM AND SC9.C9_PRODUTO = SC6.C6_PRODUTO AND SC9.C9_ITEM = SC6.C6_ITEM
	LEFT JOIN SD2010 SD2501 ON SD2501.D_E_L_E_T_ = '' AND SD2501.D2_FILIAL = SL2A.L2_FILIAL AND SD2501.D2_SERIE = SL2A.L2_SERIE AND SD2501.D2_DOC = SL2A.L2_DOC AND SD2501.D2_COD = SL2A.L2_PRODUTO
	LEFT JOIN SD2010 SD2700 ON SD2700.D_E_L_E_T_ = '' AND SD2700.D2_FILIAL = SC9.C9_FILIAL AND SD2700.D2_SERIE = SC9.C9_SERIENF AND SD2700.D2_DOC = SC9.C9_NFISCAL AND SD2700.D2_COD = SC9.C9_PRODUTO
WHERE 1=1
	AND SE3.D_E_L_E_T_ = '' 
	AND SE3.E3_ZCODRT = '3'
	AND SE3.E3_EMISSAO BETWEEN '20200101' AND '20201231'
	--AND SUA.UA_TPFRETE = 'C'
	/*700*/
	--AND SE3.E3_PEDIDO = '010967'
	--AND SE3.E3_PEDIDO = '028789'
	/*501*/
	--AND SE3.E3_PEDIDO = '032379'
	--AND SE3.E3_PEDIDO IN ('027502','024854','007495')
	AND CONCAT(SD2501.D2_DOC,SD2700.D2_DOC) <> ''
GROUP BY
	SE3.E3_FILIAL,
	SE3.E3_SERIE,
	SE3.E3_NUM,
	SE3.E3_PEDIDO,
	SE3.E3_EMISSAO,
	SL2A.L2_DOC,
	SD2501.D2_SERIE,
	SD2700.D2_SERIE,
	SD2501.D2_DOC,
	SD2700.D2_DOC,
	SD2501.D2_EMISSAO,
	SD2700.D2_EMISSAO,
	SE3.E3_CODCLI,
	SA1.A1_NOME,
	SA1.A1_MUN,
	SE3.E3_VEND,
	SA3.A3_NOME,
	SE3.E3_BASE	  

