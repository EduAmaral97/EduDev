
SELECT
SD2.D2_SERIE	AS SERIE,
SD2.D2_DOC		AS DOC,
SD2.D2_CF		AS CFOP,
SX5.X5_DESCRI	AS DESC_CFOP,
SD2.D2_COD		AS CODPROD,
SB1.B1_ZDESRDZ	AS PRODUTO,
SB1.B1_UM		AS UM,
CASE
	WHEN SUA501.UA_NUM <> '' AND SUA501.UA_ZTIPVND = '1'
THEN 'VAREJO'
	WHEN SUA700.UA_NUM <> '' AND SUA700.UA_ZTIPVND = '1'
THEN 'VAREJO'
	WHEN SUA501.UA_NUM <> '' AND SUA501.UA_ZTIPVND = '2'
THEN 'PROJETO'
	WHEN SUA700.UA_NUM <> '' AND SUA700.UA_ZTIPVND = '2'
THEN 'PROJETO'
	WHEN SUA501.UA_NUM <> '' AND SUA501.UA_ZTIPVND = '3'
THEN 'IND/ADEGA'
	WHEN SUA700.UA_NUM <> '' AND SUA700.UA_ZTIPVND = '3'
THEN 'IND/ADEGA'
	WHEN SUA501.UA_NUM <> '' AND SUA501.UA_ZTIPVND = '4'
THEN 'IND/PAINEL'
	WHEN SUA700.UA_NUM <> '' AND SUA700.UA_ZTIPVND = '4'
THEN 'IND/PAINEL'
	WHEN SUA501.UA_NUM <> '' AND SUA501.UA_ZTIPVND = '5'
THEN 'IND/CAMARA FRIA'
	WHEN SUA700.UA_NUM <> '' AND SUA700.UA_ZTIPVND = '5'
THEN 'IND/CAMARA FRIA'
	WHEN SUA501.UA_NUM <> '' AND SUA501.UA_ZTIPVND = '6'
THEN 'IND/WALK-IN COOLER'
	WHEN SUA700.UA_NUM <> '' AND SUA700.UA_ZTIPVND = '6'
THEN 'IND/WALK-IN COOLER'
ELSE ''
END AS TIPO_VENDA,
SC9.C9_PEDIDO AS PEDIDO_VENDA,
CASE
	WHEN SUA501.UA_NUM <> ''
THEN SUA501.UA_NUM
	WHEN SUA700.UA_NUM  <> ''
THEN SUA700.UA_NUM
ELSE ''
END AS ATENDIMENTO,
CASE
	WHEN SUA501.UA_NUM <> ''
THEN SUA501.UA_ZDTLBFT
	WHEN SUA700.UA_NUM  <> ''
THEN SUA700.UA_ZDTLBFT
ELSE ''
END AS DT_PEDIDO,
CASE
	WHEN SUA501.UA_NUM <> ''
THEN SUA501.UA_ZHRLBFT
	WHEN SUA700.UA_NUM  <> ''
THEN SUA700.UA_ZHRLBFT
ELSE ''
END AS HR_PEDIDO,
CASE
	WHEN SUA501.UA_NUM <> ''
THEN SL1501.L1_EMISNF
	WHEN SUA700.UA_NUM  <> ''
THEN SL1PVPAI.L1_EMISNF
ELSE ''
END AS DT_FIN,
SF2.F2_EMISSAO	AS DT_FAT,
SF2.F2_HORA		AS HR_FAT,
SD2.D2_FILIAL	AS FILIAL_FAT,
CASE
	WHEN SUA501.UA_NUM <> ''
THEN SUA501.UA_FILIAL
	WHEN SUA700.UA_NUM  <> ''
THEN SUA700.UA_FILIAL
ELSE ''
END AS FILIAL_VENDA,
CASE
	WHEN SA2.A2_COD <> ''
THEN SA2.A2_COD
	WHEN SA1.A1_COD <> ''
THEN SA1.A1_COD
ELSE ''
END AS COD_CLIFOR,
CASE
	WHEN SA2.A2_COD <> ''
THEN SA2.A2_NOME
	WHEN SA1.A1_COD <> ''
THEN SA1.A1_NOME
ELSE ''
END AS CLIFOR,
CASE
	WHEN SA2.A2_COD <> ''
THEN SA2.A2_BAIRRO
	WHEN SA1.A1_COD <> ''
THEN SA1.A1_BAIRRO
ELSE ''
END AS BAIRRO,
CASE
	WHEN SA2.A2_COD <> ''
THEN SA2.A2_MUN
	WHEN SA1.A1_COD <> ''
THEN SA1.A1_MUN
ELSE ''
END AS CIDADE,
CASE
	WHEN SA2.A2_COD <> ''
THEN SA2.A2_EST
	WHEN SA1.A1_COD <> ''
THEN SA1.A1_EST
ELSE ''
END AS ESTADO,
CASE
	WHEN SA2.A2_COD <> ''
THEN SA2.A2_CEP
	WHEN SA1.A1_COD <> ''
THEN SA1.A1_CEP
ELSE ''
END AS CEP,
CASE
	WHEN SA2.A2_COD <> ''
THEN SA2.A2_IBGE
	WHEN SA1.A1_COD <> ''
THEN SA1.A1_IBGE
ELSE ''
END AS IBGE,
SC9.C9_QTDLIB AS QTD_PED,
SD2.D2_QUANT AS QTD_FAT,
SB1.B1_PESBRU * SD2.D2_QUANT AS PESO_TOTAL,
(SB5.B5_ALTURA * SB5.B5_LARG * SB5.B5_COMPR) * SD2.D2_QUANT AS CUBAGEM_TOTAL,
SD2.D2_TOTAL AS VALOR_ITEM
FROM SD2010 SD2
LEFT JOIN SF2010 SF2 ON SF2.D_E_L_E_T_ = '' 	AND SF2.F2_SERIE = SD2.D2_SERIE AND SF2.F2_DOC = SD2.D2_DOC AND SF2.F2_CLIENTE = SD2.D2_CLIENTE AND SF2.F2_LOJA = SD2.D2_LOJA
LEFT JOIN SB1010 SB1 ON SB1.D_E_L_E_T_ = '' 	AND SB1.B1_COD = SD2.D2_COD
LEFT JOIN SX5010 SX5 ON SX5.D_E_L_E_T_ = '' 	AND SX5.X5_CHAVE = SD2.D2_CF 
LEFT JOIN SC9010 SC9 ON SC9.D_E_L_E_T_ = '' 	AND SC9.C9_FILIAL = SD2.D2_FILIAL AND SC9.C9_SERIENF = SD2.D2_SERIE AND SC9.C9_NFISCAL = SD2.D2_DOC AND SC9.C9_PRODUTO = SD2.D2_COD AND SC9.C9_ITEM = SD2.D2_ITEMPV
LEFT JOIN SL1010 SL1PVFILHO ON SL1PVFILHO.D_E_L_E_T_ = '' AND SL1PVFILHO.L1_FILIAL = SC9.C9_FILIAL AND SL1PVFILHO.L1_PEDRES = SC9.C9_PEDIDO
LEFT JOIN SL1010 SL1PVPAI ON SL1PVPAI.D_E_L_E_T_ = '' AND SL1PVPAI.L1_FILIAL = SL1PVFILHO.L1_FILRES AND SL1PVPAI.L1_NUM = SL1PVFILHO.L1_ORCRES
LEFT JOIN SUA010 SUA700 ON SUA700.D_E_L_E_T_ = '' AND SUA700.UA_FILIAL = SL1PVPAI.L1_FILIAL AND SUA700.UA_NUM = SL1PVPAI.L1_NUMATEN
LEFT JOIN SL1010 SL1501 ON SL1501.D_E_L_E_T_ = '' AND SL1501.L1_FILIAL = SD2.D2_FILIAL AND SL1501.L1_SERIE = SD2.D2_SERIE AND SL1501.L1_DOC = SD2.D2_DOC AND SL1501.L1_ORCRES = ''
LEFT JOIN SUA010 SUA501 ON SUA501.D_E_L_E_T_ = '' AND SUA501.UA_FILIAL = SL1501.L1_FILIAL AND SUA501.UA_NUM = SL1501.L1_NUMATEN
LEFT JOIN SA1010 SA1 ON SA1.D_E_L_E_T_ = ''     AND SA1.A1_COD = SD2.D2_CLIENTE AND SA1.A1_LOJA = SD2.D2_LOJA 
LEFT JOIN SA2010 SA2 ON SA2.D_E_L_E_T_ = ''     AND SA2.A2_COD = SD2.D2_CLIENTE AND SA2.A2_LOJA = SD2.D2_LOJA AND  SD2.D2_TIPO = 'D' AND SD2.D2_CF IN ('5202', '6202', '6201', '5411', '5949', '6949', '5411', '6918', '5913')
LEFT JOIN SB5010 SB5 ON SB5.D_E_L_E_T_ = ''     AND SB5.B5_COD = SB1.B1_COD
--LEFT JOIN SE3010 SE3 ON SE3.D_E_L_E_T_ = '' 	AND SE3.E3_PEDIDO = SUA.UA_NUM AND SE3.E3_ZCODRT = '3'
--LEFT JOIN SE3010 SE3PV ON SE3PV.D_E_L_E_T_ = '' AND SE3PV.E3_PEDIDO = SUAPV.UA_NUM AND SE3PV.E3_ZCODRT = '3'  
WHERE 1=1
AND SD2.D_E_L_E_T_ = ''
AND YEAR(SD2.D2_EMISSAO) = '2020'
AND SUBSTRING(SB1.B1_GRUPO,1,2) IN ('MR','CF', 'MP')
--AND SB1.B1_COD <> '40432'
--AND SC9.C9_PEDIDO = '000736'
--AND SD2.D2_DOC = '000028303'
--AND SD2.D2_DOC IN ('000029551','000029548', '000029790')




