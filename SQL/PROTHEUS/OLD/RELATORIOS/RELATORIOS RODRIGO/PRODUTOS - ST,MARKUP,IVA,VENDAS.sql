
SELECT 
SB1.B1_COD		AS CODPROD,
SB1.B1_ZDESRDZ	AS PRODUTO,
SB1.B1_ZAPRES1	AS COD_APRE,
SB1.B1_GRUPO	AS GRUPO,
SB1.B1_GRTRIB	AS GRUPO_TRIB,
SB1.B1_CUSTD	AS CUSTO,
SB1.B1_PICMENT	AS IVA ,
SB1.B1_ZPERCAT 	AS MARKUP,
ISNULL((
SELECT 
SUM(SL2.L2_QUANT)
FROM SL1010 SL1 
LEFT JOIN SL2010 SL2 ON SL2.D_E_L_E_T_ = '' AND SL2.L2_FILIAL = SL1.L1_FILIAL AND SL2.L2_NUM = SL1.L1_NUM
WHERE 1=1
AND SL1.D_E_L_E_T_ = ''
AND SL1.L1_ORCRES = ''
AND SL1.L1_EMISNF <> ''
AND YEAR(SL1.L1_EMISNF) = YEAR(GETDATE())
AND MONTH(SL1.L1_EMISNF) = MONTH(GETDATE())
AND SL2.L2_PRODUTO = SB1.B1_COD
),0) AS MES_ATUAL,
ISNULL((
SELECT 
SUM(SL2.L2_QUANT)
FROM SL1010 SL1 
LEFT JOIN SL2010 SL2 ON SL2.D_E_L_E_T_ = '' AND SL2.L2_FILIAL = SL1.L1_FILIAL AND SL2.L2_NUM = SL1.L1_NUM
WHERE 1=1
AND SL1.D_E_L_E_T_ = ''
AND SL1.L1_ORCRES = ''
AND SL1.L1_EMISNF <> ''
AND YEAR(SL1.L1_EMISNF) = YEAR(GETDATE())
AND MONTH(SL1.L1_EMISNF) = MONTH(GETDATE()) -1
AND SL2.L2_PRODUTO = SB1.B1_COD
),0) AS MES_ANTERIOR,
ISNULL((
SELECT 
SUM(SL2.L2_QUANT)
FROM SL1010 SL1 
LEFT JOIN SL2010 SL2 ON SL2.D_E_L_E_T_ = '' AND SL2.L2_FILIAL = SL1.L1_FILIAL AND SL2.L2_NUM = SL1.L1_NUM
WHERE 1=1
AND SL1.D_E_L_E_T_ = ''
AND SL1.L1_ORCRES = ''
AND SL1.L1_EMISNF <> ''
AND YEAR(SL1.L1_EMISNF) = YEAR(GETDATE())
AND MONTH(SL1.L1_EMISNF) = MONTH(GETDATE()) -2
AND SL2.L2_PRODUTO = SB1.B1_COD
),0) AS MES_RETRASADO
FROM SB1010 SB1
WHERE 1=1
AND SB1.D_E_L_E_T_ = ''
AND SB1.B1_GRTRIB = '000009'
AND SB1.B1_COD = 'EG007CR        '
 